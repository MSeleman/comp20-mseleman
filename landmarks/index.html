<!DOCTYPE html>

<html>

	<head>
		<title>Geolocation Map Example</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="style.css" />
		<meta charset="utf-8">
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
		<!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6G5DzhxTBUWyUl1l4rtUCH4shvbsf8LM&callback=init"
		 async defer> </script> -->
		<script>
			var map;
			var marker;
			var lat = 0;
			var lng = 0;
			var infowindow = new google.maps.InfoWindow();
			var me = new google.maps.LatLng(lat, lng);
			var request = new XMLHttpRequest();
			var url = "https://defense-in-derpth.herokuapp.com/sendLocation"

			request.open("POST", url, true);

			request.onreadystatechange = function (){

				if(request.readyState == 4 && request.status == 200){
					console.log("HI");
					var rawData = request.responseText;
					var messages; //creates javascript objects 
					var output = "<ul>";


					if( rawData != null){
						messages = JSON.parse(rawData);
					}
					for (count = 0; count < messages.length; count++){

						output = output + "<li>" + messages[count].content + "=>" + messages[count].username + "</li>";
					}
					output +=  "</ul>";



				}
			}
			request.send();


      		function getMyLocation(){

      			console.log("getMyLoc");
      			if(navigator.geolocation) {

      				navigator.geolocation.getCurrentPosition(function(pos) {
      					lat = pos.coords.latitude;
      					lng = pos.coords.longitude;
      					init();
      					setLocation();
      				});
      			}
      		}

      		function init() {
      			console.log("init");
       			map = new google.maps.Map(document.getElementById("map"), {
         		center: {lat: lat, lng: lng},
        		zoom: 5
       	 		});
      		}

      		function setLocation() {
      			console.log("setLoc");
      			me = new google.maps.LatLng(lat, lng);


      			map.panTo(me);
      			marker = new google.maps.Marker({
      				position: me,
      				title: "HI"

      			});
      			marker.setMap(map);

      			google.maps.event.addListener(marker, 'click', function() {
      				console.log("click");
					infowindow.setContent(marker.title);
					infowindow.open(map, marker);
				});
      		}


   		</script>

	</head>
	
	<body onload="getMyLocation()">
		<div id="map"></div>
	</body>
</html>
